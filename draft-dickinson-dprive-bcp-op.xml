<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd' []>
<rfc ipr="trust200902" category="bcp" docName="draft-dickinson-bcp-op-00">
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc private=""?>
<?rfc topblock="yes"?>
<?rfc comments="no"?>
<front>
<title abbrev="DNS Privacy Service Recommendations">Recommendations for DNS Privacy Service Operators</title>

<author initials="S." surname="Dickinson" fullname="Sara Dickinson">
<organization>Sinodun IT</organization>
<address>
<postal>
<street></street>
<street>Magdalen Centre</street>
<street>Oxford Science Park</street>
<city>Oxford</city>
<code>OX4 4GA</code>
<country>United Kingdom</country>
<region></region>
</postal>
<phone></phone>
<email>sara@sinodun.com</email>
<uri></uri>
</address>
</author>
<author initials="R." surname="van Rijswijk-Deij" fullname="Roland M. van Rijswijk-Deij">
<organization>SURFnet bv</organization>
<address>
<postal>
<street></street>
<street>PO Box 19035 </street>
<city>Utrecht</city>
<code>3501 DA Utrecht</code>
<country>The Netherlands</country>
<region></region>
</postal>
<phone></phone>
<email>roland.vanrijswijk@surfnet.nl</email>
<uri></uri>
</address>
</author>
<author initials="A." surname="Mankin" fullname="Allison Mankin">
<organization>Salesforce</organization>
<address>
<postal>
<street></street>
<city></city>
<code></code>
<country></country>
<region></region>
</postal>
<phone></phone>
<email>allison.mankin@gmail.com</email>
<uri></uri>
</address>
</author>
<date year="2018" month="March" day="5"/>

<area>Internet</area>
<workgroup>dprive</workgroup>
<keyword>DNS</keyword>


<abstract>
<t>This document presents operational, policy and security considerations for DNS
operators who choose to offer DNS Privacy services including, but not limited
to, DNS-over-TLS <xref target="RFC7858"/>.
</t>
<t>This document also presents a framework to assist writers of DNS Privacy Policy
and Practices Statements (analogous to DNS Security Extensions (DNSSEC) Policies
and DNSSEC Practice Statements described in <xref target="RFC6841"/>).
</t>
</abstract>


</front>

<middle>

<section anchor="introduction" title="Introduction">
<t>[NOTE: This document is submitted to the IETF for initial review and for
feedback on the best forum for future versions of this document.]
</t>
<t>The Domain Name System (DNS) was not originally designed with strong security or
privacy mechanisms. <xref target="RFC7626"/> describes the privacy issues associated with the
use of the DNS by Internet users including those related to un-encrypted DNS
messages on the wire and DNS 'query log' data maintained on DNS servers.
</t>
<t>Two documents that provide ways to increase DNS privacy between DNS clients and
DNS servers are:
</t>
<t>
<list style="symbols">
<t>Specification for DNS over Transport Layer Security (TLS) <xref target="RFC7858"/>,
referred to here as simply 'DNS-over-TLS'</t>
<t>DNS over Datagram Transport Layer Security (DTLS) <xref target="RFC8094"/>, referred to
here simply as 'DNS-over-DTLS'. Note that this document has the Category of
Experimental.</t>
</list>
</t>
<t>Both documents are limited in scope to communications between stub clients and
recursive resolvers and the same scope is applied to this document.
Other documents that provide further specifications related to DNS
privacy include  <xref target="I-D.ietf-dprive-dtls-and-tls-profiles"/>, <xref target="RFC7830"/> and
<xref target="I-D.ietf-dprive-padding-policy"/>.
</t>
<t>Note that <xref target="I-D.ietf-dnsop-dns-tcp-requirements"/> discusses operational
requirements for DNS-over-TCP but does not provide specific guidance on DNS
privacy protocols.
</t>
<t>This document includes operational guidance related to <xref target="RFC7858"/> and
<xref target="RFC8094"/>.
</t>
<t>In recent years there has been an increase in the availability of &quot;open&quot;
resolvers. Operators of some open resolvers choose to enable protocols which
encrypt DNS on the wire to cater for users who are privacy conscious. Whilst
protocols that encrypt DNS messages on the wire provide protection against
certain attacks, the resolver operator still has (in principle) full visibility
of the query data for each user and therefore a trust relationship exists. The
ability of the operator to provide a transparent, well documented, and secure
privacy service will likely serve as a major differentiating factor for privacy
conscious users.
</t>
<t>More recently the global legislative landscape with regard to personal data
collection, retention, and psuedo-anonymisation has seen significant activity
with differing requirements active in different jurisdictions. The impact of
these changes on data pertaining to the users of Internet Service Providers and
specifically DNS open resolvers is not fully understood at the time of writing.
It may be in certain cases that these requirement may well conflict with the
IETF's end-to-end encryption principles.
</t>
<t>This document also attempts to outline options for data handling for
operators of DNS privacy services.
</t>
<t>TODO/QUESTION: Discuss alternative (non-standard) schemes not covered by this
document e.g. DNSCrypt, IPsec, VPNs. For example, should the data handling
practices be recommended for any service that encrypts DNS/makes claims about
DNS data privacy or is that outside the scope of this document?
</t>
<t>This document also presents a framework to assist writers of DNS Privacy Policy
and Practice Statements (DPPPS). These are documents an operator can publish
outlining their operational practices and commitments with regard to privacy
providing a means for clients to evaluate the privacy properties of a given DNS
privacy service. In particular, the framework identifies the elements that
should be considered in formulating a DPPPS. It does not, however, define a
particular Policy or Practice Statement, nor does it seek to provide legal
advice or recommendations as to the contents.
</t>
<t>Community knowledge about operational practices can change quickly, and
experience shows that a Best Current Practice (BCP) document about privacy and
security is a point-in-time statement. Readers are advised to seek out any
errata or updates that apply to this document.
</t>
</section>

<section anchor="terminology" title="Terminology">
<t>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
&quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
document are to be interpreted as described in <xref target="RFC8174"/>.
</t>
<t>
<list style="symbols">
<t>Privacy-enabling DNS server: A DNS server that implements DNS-over-TLS
[RFC7858] and may optionally implement DNS-over-DTLS [RFC8094]. The server
should also offer at least one of the credentials described in Section 8 of
<xref target="I-D.ietf-dprive-dtls-and-tls-profiles"/> and implement the (D)TLS profile
described in Section 9 of <xref target="I-D.ietf-dprive-dtls-and-tls-profiles"/>.</t>
<t>DPPPS: DNS Privacy Policy and Practice Statement, see
<xref target="dns-privacy-policy-and-practice-statement"/>.</t>
<t>DNS privacy service: The service that is offered via a privacy-enabling DNS
server and is documented either in an informal statement of policy and
practice with regard to users privacy or a formal DPPPS.</t>
</list>
</t>
</section>

<section anchor="server-capabilities-to-maximise-dns-privacy" title="Server capabilities to maximise DNS privacy">

<section anchor="general-capabilities" title="General capabilities">
<t>In addition to Sections 9 and 11.1 of <xref target="I-D.ietf-dprive-dtls-and-tls-profiles"/> DNS privacy services SHOULD offer the following capabilities/options:
</t>
<t>
<list style="symbols">
<t>QNAME minimisation <xref target="RFC7816"/></t>
<t>Management of TLS connections to optimise performance for clients using either
<list style="symbols">
<t><xref target="RFC7766"/> and EDNS(0) Keepalive <xref target="RFC7828"/> and/or</t>
<t>DNS Stateful Operations <xref target="I-D.ietf-dnsop-session-signal"/></t>
</list></t>
<t>No requirement that clients must use TLS session resumption <xref target="RFC5077"/> (or
Domain Name System (DNS) Cookies <xref target="RFC7873"/>)</t>
</list>
</t>
<t>DNS privacy services MAY offer the following capabilities:
</t>
<t>
<list style="symbols">
<t>DNS privacy service on both port 853 and 443 (to circumvent blocking of
port 853)</t>
<t>A .onion <xref target="RFC7686"/> service endpoint</t>
<t>Aggressive Use of DNSSEC-Validated Cache <xref target="RFC8198"/> to reduce the number of
queries to authoritative servers to increase privacy.</t>
<t>Run a copy of the root zone on loopback <xref target="RFC7706"/> to avoid making queries to
the root servers that might leak information.</t>
</list>
</t>
<t>QUESTION: Should we say anything here about filtering responses or DNSSEC
validation e.g. operators SHOULD provide an unfiltered service on an alternative
IP address if the 'main' DNS privacy address filters responses? Or simply just
to say that the DNS privacy service should not differ from the 'normal' DNS
service in terms of such options.
</t>
</section>

<section anchor="client-query-obfuscation" title="Client query obfuscation">
<t>Since queries from recursive resolvers to authoritative servers are performed
using cleartext (at the time of writing), resolver services need to consider the
extent to which they may be directly leaking information about their client
community via these upstream queries and what they can do to mitigate this
further. Note, that even when all the relevant techniques described above are
employed there may still be attacks possible, e.g.
<xref target="Pitfalls-of-DNS-Encryption"/>. For example, a resolver with a very small
community of users risks exposing data in this way and MAY want to obfuscate
this traffic by mixing it with 'generated' traffic to make client
characterisation harder.
</t>
</section>

<section anchor="availability" title="Availability">
<t>As a general model of trust between users and service providers DNS privacy
services should have high availability. Denying access to an encrypted protocol
for DNS queries forces the user to switch providers, fallback to cleartext or
accept no DNS service for the outage.
</t>
</section>

<section anchor="authentication-of-dns-privacy-services" title="Authentication of DNS privacy services">
<t>To enable users to select a 'Strict Privacy' usage profile
<xref target="I-D.ietf-dprive-dtls-and-tls-profiles"/> DNS privacy services should provide
credentials in the form of either X.509 certificates, SPKI pinsets or TLSA
records. This in effect commits the DNS privacy service to a public identity
users will trust.
</t>
<t>Anecdotal evidence to date highlights this requirement as one of the more
challenging aspects of running a DNS privacy service as management of such
credentials is new to DNS operators.
</t>

<section anchor="generation-and-publication-of-certificates" title="Generation and publication of certificates">
<t>It is RECOMMENDED that operators:
</t>
<t>
<list style="symbols">
<t>Choose a short, memorable authentication name for their service</t>
<t>Automate the generation and publication of certificates</t>
<t>Monitor certificates to prevent accidental expiration of certificates</t>
</list>
</t>
</section>

<section anchor="management-of-spki-pins" title="Management of SPKI pins">
<t>TODO
</t>
</section>

<section anchor="tlsa-records" title="TLSA records">
<t>TODO
</t>
</section>
</section>
</section>

<section anchor="operational-management" title="Operational management">

<section anchor="limitations-of-using-a-pure-tls-proxy" title="Limitations of using a pure TLS proxy">
<t>Some operators may choose to implement DNS-over-TLS using a TLS proxy (e.g.
<eref target="https://nginx.org/">nginx</eref> or <eref target="https://www.haproxy.org/">haproxy</eref>) in front of
a DNS nameserver because of proven robustness and capacity when handling large
numbers of client connections, load balancing capabilities and good tooling.
Currently, however, because such proxies typically have no specific handling of
DNS as a protocol over TLS or DTLS using them can restrict traffic management at
the proxy layer and at the DNS server. For example, all traffic received by a
nameserver behind such a proxy will appear to originate from the proxy and DNS
techniques such as ACLs or RRL will be hard or impossible to implement in the
nameserver.
</t>
</section>

<section anchor="anycast-deployments" title="Anycast deployments">
<t>TODO:
</t>
</section>
</section>

<section anchor="server-data-handling" title="Server data handling">
<t>The following are common activities for DNS service operators and in all cases
should be minimised or completely avoided if possible for DNS privacy services.
If data is retained it should be encrypted and either aggregated,
psuedo-anonymised or de-identified whenever possible.
</t>
<t>
<list style="symbols">
<t>Logging and Monitoring: Only that required to sustain operation of the service
and meet regulatory requirements.</t>
<t>Data retention: Data SHOULD be retained for the shortest period deemed
operationally feasible.</t>
<t>User tracking: DNS privacy services SHOULD not track users. An exception may
be malicious or anomalous use of the service.</t>
<t>Providing data to third-parties (sharing, selling or renting): Operators
SHOULD not provide data to third-parties without explicit consent from users
(simply using the resolution service itself does not constitute consent).</t>
<t>Access to stored personal data: Access SHOULD be minimised to only those
personal who require access to perform operational duties.</t>
</list>
</t>

<section anchor="psuedoanonymisation-and-deidentification-methods" title="Psuedo-anonymisation and de-identification methods">
<t>There is active discussion in the space of effective psuedo-anonymisation of
personal data in DNS query logs. To-date this has focussed on
psuedo-anonymisation of client IP addresses, however there are as yet no
standards for this that are unencumbered by patents. This section briefly
references some know methods in this space at the time of writing.
</t>

<section anchor="ipcipher" title="ipcipher">
<t><xref target="ipcipher-spec"/> is a psuedo-anonymisation technique which encrypts IPv4 and IPv6
addresses such that any address encrypts to a valid address. At the time of
writing the specification is under review and may be the subject of a future
IETF draft.
</t>
</section>

<section anchor="bloom-filters" title="Bloom filters">
<t>There is also on-going work in the area of using Bloom filters as a
privacy-enhancing technology for DNS monitoring <xref target="DNS-bloom-filter"/>. The goal of
this work is to allow operators to identify so-called Indicators of Compromise
(IOCs) originating from specific subnets without storing information about, or
be able to monitor the DNS queries of an individual user.
</t>
</section>
</section>
</section>

<section anchor="dns-privacy-policy-and-practice-statement" title="DNS privacy policy and practice statement">

<section anchor="current-privacy-statements" title="Current privacy statements">
<t>TODO: Compare main elements of Google vs Quad9 vs OpenDNS policies
</t>
</section>

<section anchor="recommended-contents-of-a-dppps" title="Recommended contents of a DPPPS">
<t>
<list style="symbols">
<t>Policy: This section should explain the policy for gathering and disseminating
information collected by the DNS privacy service.
<list style="symbols">
<t>Specify clearly what data (including whether it is aggregated,
psuedo-anonymised or de-identified) is</t>
<t>Collected and retained by the operator (and for how long)</t>
<t>Shared with, sold or rented to third-parties</t>
<t>Specify any exceptions to the above, for example malicious or anomalous
behaviour</t>
<t>Declare any third-party affiliations or funding</t>
<t>Whether user DNS data is correlated or combined with any other personal
information held by the operator</t>
</list></t>
<t>Practice: This section should explain the current operational practices of the
service.
<list style="symbols">
<t>Specify any temporary or permanent deviations from the policy for
operational reasons</t>
<t>Provide specific details of which capabilities are provided on which address
and ports</t>
<t>Specify the authentication name to be used (if any)</t>
<t>Specify the SPKI pinsets to be used (if any) and policy for rolling keys</t>
<t>Provide a contact email address for the service</t>
</list></t>
</list>
</t>
</section>

<section anchor="enforcementaccountability" title="Enforcement/accountability">
<t>Transparency reports may help with building user trust that operators adhere to their policies and practices.
</t>
<t>Independent monitoring should be performed where possible of:
</t>
<t>
<list style="symbols">
<t>ECS, QNAME minimisation, EDNS(0) padding, etc.</t>
<t>Filtering</t>
<t>Uptime</t>
</list>
</t>
</section>
</section>

<section anchor="iana-considerations" title="IANA considerations">
<t>None
</t>
</section>

<section anchor="security-considerations" title="Security considerations">
<t>TODO: e.g. New issues for DoS defence, server admin policies
</t>
</section>

<section anchor="acknowledgements" title="Acknowledgements">
<t>Many thanks to John Dickinson for review of and input to the first draft of this
document.
</t>
<t>Thanks to Benno Overeinder and John Todd for discussions on this topic.
</t>
</section>

<section anchor="changelog" title="Changelog">
<t>draft-dickinson-dprive-bcp-op-00
</t>
<t>
<list style="symbols">
<t>Initial commit</t>
</list>
</t>
</section>

</middle>
<back>
<references title="Normative References">
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-session-signal.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dprive-dtls-and-tls-profiles.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dprive-padding-policy.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5077.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7626.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7766.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7816.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7828.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7830.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7858.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7873.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8094.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"?>
</references>
<references title="Informative References">
<reference anchor='DNS-bloom-filter'
 target=' https://tnc18.geant.org/getfile/3823'>
    <front>
        <title>Let a Thousand Filters Bloom. DNS-Based Threat Monitoring That Respects User Privacy</title>
        <author initials='R.' surname='van Rijswijk-Deij' fullname='Roland van Rijswijk-Deij'>
         <organization>SURFnet bv</organization>
        </author>
        <author initials='M.' surname='Bomhoff' fullname='Matthijs Bomhoff'>
         <organization>Quarantainenet B.V.</organization>
        </author>
        <author initials='R.' surname='Dolmans' fullname='Ralph Dolmans'>
         <organization>NLnet Labs Foundation</organization>
        </author>
        <date year='2018'/>
    </front>
</reference>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-dns-tcp-requirements.xml"?>
<reference anchor='Pitfalls-of-DNS-Encryption'
 target='https://www.ietf.org/mail-archive/web/dns-privacy/current/pdfWqAIUmEl47.pdf'>
    <front>
        <title>Pretty Bad Privacy: Pitfalls of DNS Encryption</title>
        <author initials='H.' surname='Shulman' fullname='Haya Shulman'>
            <organization>Fachbereich Informatik, Technische Universit√§t Darmstadt</organization>
        </author>
        <date year='2014'/>
    </front>
</reference>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6841.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7686.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7706.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8198.xml"?>
<reference anchor='ipcipher-spec'
 target='https://powerdns.org/ipcipher/'>
    <front>
        <title>ipcipher: encrypting IP addresses</title>
        <author initials='B.' surname='Hubert' fullname='Bert Hubert'>
            <organization>PowerDNS</organization>
        </author>
        <date year='2018'/>
    </front>
</reference>
</references>

</back>
</rfc>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd' []>
<rfc ipr="trust200902" category="bcp" docName="draft-ietf-dprive-bcp-op-00">
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc private=""?>
<?rfc topblock="yes"?>
<?rfc comments="no"?>
<front>
<title abbrev="DNS Privacy Service Recommendations">Recommendations for DNS Privacy Service Operators</title>

<author initials="S." surname="Dickinson" fullname="Sara Dickinson">
<organization>Sinodun IT</organization>
<address>
<postal>
<street></street>
<street>Magdalen Centre</street>
<street>Oxford Science Park</street>
<city>Oxford</city>
<code>OX4 4GA</code>
<country>United Kingdom</country>
<region></region>
</postal>
<phone></phone>
<email>sara@sinodun.com</email>
<uri></uri>
</address>
</author>
<author initials="B." surname="Overeinder" fullname="Benno J. Overeinder">
<organization>NLnet Labs</organization>
<address>
<postal>
<street></street>
<street>Science Park 400</street>
<city>Amsterdam</city>
<code>1098 XH</code>
<country>The Netherlands</country>
<region></region>
</postal>
<phone></phone>
<email>benno@nlnetLabs.nl</email>
<uri></uri>
</address>
</author>
<author initials="R." surname="van Rijswijk-Deij" fullname="Roland M. van Rijswijk-Deij">
<organization>SURFnet bv</organization>
<address>
<postal>
<street></street>
<street>PO Box 19035 </street>
<city>Utrecht</city>
<code>3501 DA Utrecht</code>
<country>The Netherlands</country>
<region></region>
</postal>
<phone></phone>
<email>roland.vanrijswijk@surfnet.nl</email>
<uri></uri>
</address>
</author>
<author initials="A." surname="Mankin" fullname="Allison Mankin">
<organization>Salesforce</organization>
<address>
<postal>
<street></street>
<city></city>
<code></code>
<country></country>
<region></region>
</postal>
<phone></phone>
<email>allison.mankin@gmail.com</email>
<uri></uri>
</address>
</author>
<date year="2018" month="August" day="8"/>

<area>Internet</area>
<workgroup>dprive</workgroup>
<keyword>DNS</keyword>


<abstract>
<t>This document presents operational, policy and security considerations for DNS
operators who choose to offer DNS Privacy services. With the recommendations,
the operator can make deliberate decisions which services to provide, and how
the decisions and alternatives impact the privacy of users.
</t>
<t>This document also presents a framework to assist writers of DNS Privacy Policy
and Practices Statements (analogous to DNS Security Extensions (DNSSEC) Policies
and DNSSEC Practice Statements described in <xref target="RFC6841"/>).
</t>
</abstract>


</front>

<middle>

<section anchor="introduction" title="Introduction">
<t>[NOTE: This document is submitted to the IETF for initial review and for
feedback on the best forum for future versions of this document. Initial
considerations for DoH <xref target="I-D.ietf-doh-dns-over-https"/> are included here in
anticipation of that draft progressing to be an RFC but further analysis is
required.]
</t>
<t>The Domain Name System (DNS) is at the core of the Internet; almost every
activity on the Internet starts with a DNS query (and often several). However
the DNS was not originally designed with strong security or privacy mechanisms.
A number of developments have taken place in recent years which aim to increase
the privacy of the DNS system and these are now seeing some deployment. This
latest evolution of the DNS presents new challenges to operators and this
document attempts to provide an overview of considerations for privacy focussed
DNS services.
</t>
<t>In recent years there has also been an increase in the availability of &quot;open
resolvers&quot; <xref target="I-D.ietf-dnsop-terminology-bis"/> which users may prefer to use
instead of the default network resolver because they offer a specific feature
(e.g. good reachability, encrypted transport, strong privacy policy, filtering
(or lack of), etc.). These open resolvers have tended to be at the forefront of
adoption of privacy related enhancements but it is anticipated that operators of
other resolver services will follow.
</t>
<t>Whilst protocols that encrypt DNS messages on the wire provide protection
against certain attacks, the resolver operator still has (in principle) full
visibility of the query data and transport identifiers for each user. Therefore,
a trust relationship exists. The ability of the operator to provide a
transparent, well documented, and secure privacy service will likely serve as a
major differentiating factor for privacy conscious users if they make an
active selection of which resolver to use.
</t>
<t>It should also be noted that the choice of a user to configure a single resolver
(or a fixed set of resolvers) and an encrypted transport to use in all network
environments has both advantages and disadvantages. For example the user has a
clear expectation of which resolvers have visibility of their query data however
this resolver/transport selection may provide an added mechanism to track them
as they move across network environments. Commitments from operators to minimize
such tracking are also likely to play a role in users selection of resolver.
</t>
<t>More recently the global legislative landscape with regard to personal data
collection, retention, and pseudonymization has seen significant activity with
differing requirements active in different jurisdictions. For example the user
of a service and the service itself may be in jurisdictions with conflicting
legislation. It is an untested area that simply using a DNS resolution service
constitutes consent from the user for the operator to process their query data.
The impact of recent legislative changes on data pertaining to the users of both
Internet Service Providers and DNS open resolvers is not fully understood at the
time of writing.
</t>
<t>This document has two main goals:
</t>
<t>
<list style="symbols">
<t>To provide operational and policy guidance related to DNS over encrypted
transports and to outline recommendations for data handling for operators of
DNS privacy services.</t>
<t>To introduce the DNS Privacy Policy and Practice Statement (DPPPS) and present
a framework to assist writers of this document. A DPPPS is a document that an
operator can publish outlining their operational practices and commitments
with regard to privacy thereby providing a means for clients to evaluate the
privacy properties of a given DNS privacy service. In particular, the
framework identifies the elements that should be considered in formulating a
DPPPS. This document does not, however, define a particular Policy or Practice
Statement, nor does it seek to provide legal advice or recommendations as to
the contents.</t>
</list>
</t>
<t>Community insight [or judgment?] about operational practices can change
quickly, and experience shows that a Best Current Practice (BCP) document about
privacy and security is a point-in-time statement. Readers are advised to seek
out any errata or updates that apply to this document.
</t>
</section>

<section anchor="scope" title="Scope">
<t>&quot;DNS Privacy Considerations&quot; <xref target="I-D.bortzmeyer-dprive-rfc7626-bis"/> describes the
general privacy issues and threats associated with the use of the DNS by
Internet users and much of the threat analysis here is lifted from that
document and from <xref target="RFC6873"/>. However this document is limited in scope to best
practice considerations for the provision of DNS privacy services by servers
(recursive resolvers) to clients (stub resolvers or forwarders). Privacy
considerations specifically from the perspective of an end user, or those for
operators of authoritative nameservers are out of scope.
</t>
<t>This document includes (but is not limited to) considerations in the following
areas (taken from <xref target="I-D.bortzmeyer-dprive-rfc7626-bis"/>):
</t>
<t>
<list style="numbers">
<t>Data &quot;on the wire&quot; between a client and a server</t>
<t>Data &quot;at rest&quot; on a server (e.g. in logs)</t>
<t>Data &quot;sent onwards&quot; from the server (either on the wire or shared with a
third party)</t>
</list>
</t>
<t>Whilst the issues raised here are targeted at those operators who choose to
offer a DNS privacy service, considerations for areas 2 and 3 could equally
apply to operators who only offer DNS over unencrypted transports but who would
like to align with privacy best practice.
</t>
</section>

<section anchor="privacy-related-documents" title="Privacy related documents">
<t>There are various documents that describe protocol changes that have the
potential to either increase or decrease the privacy of the DNS. Note this does
not imply that some documents are good or bad, better or worse, just that (for
example) some features may bring functional benefits at the price of a reduction
in privacy and conversely some features increase privacy with an accompanying
increase in complexity. A selection of the most relevant documents are listed in
<xref target="documents"/> for reference.
</t>
</section>

<section anchor="terminology" title="Terminology">
<t>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;,
&quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
document are to be interpreted as described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/>
when, and only when, they appear in all capitals, as shown here.
</t>
<t>Privacy terminology is as described in Section 3 of <xref target="RFC6973"/>.
</t>
<t>DNS terminology is as described in <xref target="I-D.ietf-dnsop-terminology-bis"/> with one
modification: we use the definition of Privacy-enabling DNS
server taken from <xref target="RFC8310"/>:
</t>
<t>
<list style="symbols">
<t>Privacy-enabling DNS server: A DNS server (most likely a full-service
resolver) that implements DNS-over-TLS <xref target="RFC7858"/>, and may optionally
implement DNS-over-DTLS <xref target="RFC8094"/>. The server should also offer at least one
of the credentials described in Section 8 and implement the (D)TLS profile
described in Section 9.

<vspace/></t>
</list>
</t>
<t>TODO: Update the definition of Privacy-enabling DNS server in
  <xref target="I-D.ietf-dnsop-terminology-bis"/> to be complete and also include DoH, then
  reference that here.
</t>
<t>
<list style="symbols">
<t>DPPPS: DNS Privacy Policy and Practice Statement, see
<xref target="dns-privacy-policy-and-practice-statement"/>.</t>
<t>DNS privacy service: The service that is offered via a privacy-enabling DNS
server and is documented either in an informal statement of policy and
practice with regard to users privacy or a formal DPPPS.</t>
</list>
</t>
</section>

<section anchor="recommendations-for-dns-privacy-services" title="Recommendations for DNS privacy services">
<t>We describe three classes of actions that operators of DNS privacy
services can take:
</t>
<t>
<list style="symbols">
<t>Threat mitigation for well understood and documented privacy threats to the
users of the service and in some cases to the operators of the service.</t>
<t>Optimization of privacy services from an operational or management perspective</t>
<t>Additional options that could further enhance the privacy and usability of the
service</t>
</list>
</t>
<t>This document does not specify policy only best practice, however for DNS
Privacy services to be considered compliant with these best practice guidelines
they SHOULD implement (where appropriate) all:
</t>
<t>
<list style="symbols">
<t>Threat mitigations to be minimally compliant</t>
<t>Optimizations to be moderately compliant</t>
<t>Additional options to be maximally compliant</t>
</list>
</t>
<t>TODO: Some of the threats listed in the following sections are taken directly
from Section 5 of RFC6973, some are just standalone descriptions, we need to go
through all of them and see if we can use the RFC6973 threats where possible
and make them consistent.
</t>

<section anchor="on-the-wire-between-client-and-server" title="On the wire between client and server">
<t>In this section we consider both data on the wire and the service provided to
the client.
</t>

<section anchor="transport-recommendations" title="Transport recommendations">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Surveillance: Passive surveillance of traffic on the wire</t>
<t>Intrusion: Active injection of spurious data or traffic</t>
</list>
</t>
<t>Mitigations:
</t>
<t>A DNS privacy service can mitigate these threats by providing service over one
or more of the following transports
</t>
<t>
<list style="symbols">
<t>DNS-over-TLS <xref target="RFC7858"/></t>
<t>DoH <xref target="I-D.ietf-doh-dns-over-https"/></t>
</list>
</t>
<t>Additional options:
</t>
<t>
<list style="symbols">
<t>A DNS privacy service can also be provided over DNS-over-DTLS <xref target="RFC8094"/>,
however note that this is an Experimental specification.</t>
<t>A DNS privacy service can also be provided over DNS-over-QUIC <xref target="I-D.huitema-quic-dnsoquic"/></t>
</list>
</t>
<t>It is noted that DNS privacy service might be provided over IPSec, DNSCrypt
or VPNs. However, use of these transports for DNS are not standardized and any
discussion of best practice for providing such service is out of scope for this
document.
</t>
</section>

<section anchor="authentication-of-dns-privacy-services" title="Authentication of DNS privacy services">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Surveillance and Intrusion: Active attacks that can redirect traffic to
rogue servers</t>
</list>
</t>
<t>Mitigations:
</t>
<t>DNS privacy services should ensure clients can authenticate the server. Note
that this, in effect, commits the DNS privacy service to a public identity users
will trust.
</t>
<t>When using DNS-over-TLS clients that select a 'Strict Privacy' usage profile
<xref target="RFC8310"/> (to mitigate the threat of active attack on the client) require the
ability to authenticate the DNS server. To enable this, DNS privacy services
that offer DNS-over-TLS should provide credentials in the form of either X.509
certificates, SPKI pinsets or TLSA records.
</t>
<t>When offering DoH <xref target="I-D.ietf-doh-dns-over-https"/>, HTTPS requires authentication
of the server as part of the protocol.
</t>
<t>Optimizations:
</t>
<t>DNS privacy services can also consider the following capabilities/options:
</t>
<t>
<list style="symbols">
<t>As recommended in <xref target="RFC8310"/> providing DANE TLSA records for the nameserver
<list style="symbols">
<t>In particular, the service could provide TLSA records such that
authenticating solely via the PKIX infrastructure can be avoided.</t>
</list></t>
<t>Implementing <xref target="I-D.ietf-tls-dnssec-chain-extension"/>
<list style="symbols">
<t>This can decrease the latency of connection setup to the server and remove
the need for the client to perform meta-queries to obtain and validate the
DANE records.</t>
</list></t>
</list>
</t>

<section anchor="certificate-management" title="Certificate management">
<t>Anecdotal evidence to date highlights the management of certificates as one of
the more challenging aspects for operators of traditional DNS resolvers that
choose to additionally provide a DNS privacy service as management of such
credentials is new to those DNS operators.
</t>
<t>It is noted that SPKI pinset management is described in <xref target="RFC7858"/> but that key
pinning mechanisms in general have fallen out of favour operationally for
various reasons.
</t>
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Invalid certificates, resulting in an unavailable service.</t>
<t>Mis-identification of a server by a client e.g. typos in URLs or
authentication domain names</t>
</list>
</t>
<t>Mitigations:
</t>
<t>It is recommended that operators:
</t>
<t>
<list style="symbols">
<t>Choose a short, memorable authentication name for their service</t>
<t>Automate the generation and publication of certificates</t>
<t>Monitor certificates to prevent accidental expiration of certificates</t>
</list>
</t>
<t>TODO: Could we provide references for certificate management best practice, for
example Section 6.5 of RFC7525?
</t>
</section>
</section>

<section anchor="protocol-recommendations" title="Protocol recommendations">

<section anchor="dnsovertls" title="DNS-over-TLS">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Known attacks on TLS such as <xref target="RFC7457"/></t>
<t>Traffic analysis (TODO: add a reference)</t>
<t>Potential for client tracking via transport identifiers</t>
<t>Blocking of well known ports (e.g. 853 for DNS-over-TLS)</t>
</list>
</t>
<t>Mitigations:
</t>
<t>In the case of DNS-over-TLS, TLS profiles from Section 9 and the
Countermeasures to DNS Traffic Analysis from section 11.1 of <xref target="RFC8310"/>
provide strong mitigations. This includes but is not limited to:
</t>
<t>
<list style="symbols">
<t>Adhering to <xref target="RFC7525"/></t>
<t>Implementing only (D)TLS 1.2 or later as specified in <xref target="RFC8310"/></t>
<t>Implementing EDNS(0) Padding <xref target="RFC7830"/> using the guidelines in
<xref target="I-D.ietf-dprive-padding-policy"/></t>
<t>Clients should not be required to use TLS session resumption <xref target="RFC5077"/>,
Domain Name System (DNS) Cookies <xref target="RFC7873"/>.</t>
<t>A DNS-over-TLS privacy service on both port 853 and 443. We note that this
practice may require revision when DoH becomes more widely deployed, because
of the potential use of the same ports for two incompatible types of service.</t>
</list>
</t>
<t>Optimizations:
</t>
<t>
<list style="symbols">
<t>Concurrent processing of pipelined queries, returning responses as soon as
available, potentially out of order as specified in <xref target="RFC7766"/>. This is often
called 'OOOR' - out-of-order responses. (Providing processing performance
similar to HTTP multiplexing)</t>
<t>Management of TLS connections to optimize performance for clients using either
<list style="symbols">
<t><xref target="RFC7766"/> and EDNS(0) Keepalive <xref target="RFC7828"/> and/or</t>
<t>DNS Stateful Operations <xref target="I-D.ietf-dnsop-session-signal"/>

<vspace/></t>
</list></t>
</list>
</t>
<t>Additional options that providers may consider:
</t>
<t>
<list style="symbols">
<t>Offer a .onion <xref target="RFC7686"/> service endpoint</t>
</list>
</t>
</section>

<section anchor="doh" title="DoH">
<t>TODO: Fill this in, a lot of overlap with DNS-over-TLS but we need to address
DoH specific ones if possible.
</t>
<t>Mitigations:
</t>
<t>
<list style="symbols">
<t>Clients should not be required to use HTTP Cookies <xref target="RFC6265"/>.</t>
<t>Clients should not be required to include any headers beyond the absolute
minimum to obtain service from a DoH server.</t>
</list>
</t>
</section>
</section>

<section anchor="availability" title="Availability">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>A failed DNS privacy service could force the user to switch providers,
fallback to cleartext or accept no DNS service for the outage.</t>
</list>
</t>
<t>Mitigations:
</t>
<t>A DNS privacy service must be engineered for high availability. Particular care
should to be taken to protect DNS privacy services against denial-of-service
attacks, as experience has shown that unavailability of DNS resolving because of
attacks is a significant motivation for users to switch services.
</t>
<t>TODO: Add reference to ongoing research on this topic.
</t>
</section>

<section anchor="service-options" title="Service options">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Unfairly disadvantaging users of the privacy service with respect to the
services available. This could force the user to switch providers, fallback to
cleartext or accept no DNS service for the outage.</t>
</list>
</t>
<t>Mitigations:
</t>
<t>A DNS privacy service should deliver the same level of service offered on
un-encrypted channels in terms of such options as filtering (or lack of), DNSSEC
validation, etc.
</t>
</section>

<section anchor="limitations-of-using-a-pure-tls-proxy" title="Limitations of using a pure TLS proxy">
<t>Optimization:
</t>
<t>Some operators may choose to implement DNS-over-TLS using a TLS proxy (e.g.
<eref target="https://nginx.org/">nginx</eref>, <eref target="https://www.haproxy.org/">haproxy</eref> or
<eref target="https://kb.isc.org/article/AA-01386/0/DNS-over-TLS.html">stunnel</eref>) in front of
a DNS nameserver because of proven robustness and capacity when handling large
numbers of client connections, load balancing capabilities and good tooling.
Currently, however, because such proxies typically have no specific handling of
DNS as a protocol over TLS or DTLS using them can restrict traffic management at
the proxy layer and at the DNS server. For example, all traffic received by a
nameserver behind such a proxy will appear to originate from the proxy and DNS
techniques such as ACLs, RRL or DNS64 will be hard or impossible to implement in
the nameserver.
</t>
<t>Operators may choose to use a DNS aware proxy such as dnsdist.
</t>
</section>
</section>

<section anchor="data-at-rest-on-the-server" title="Data at rest on the server">

<section anchor="data-handling" title="Data handling">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Surveillance</t>
<t>Stored data compromise</t>
<t>Correlation</t>
<t>Identification</t>
<t>Secondary use</t>
<t>Disclosure</t>
<t>Contravention of legal requirements not to process user data?</t>
</list>
</t>
<t>Mitigations:
</t>
<t>The following are common activities for DNS service operators and in all cases
should be minimized or completely avoided if possible for DNS privacy services.
If data is retained it should be encrypted and either aggregated, pseudonymized
or anonymized whenever possible. In general the principle of data minimization
described in <xref target="RFC6973"/> should be applied.
</t>
<t>
<list style="symbols">
<t>Transient data (e.g. that is used for real time monitoring and threat analysis
which might be held only memory) should be retained for the shortest possible
period deemed operationally feasible.</t>
<t>The retention period of DNS traffic logs should be only those required to
sustain operation of the service and, to the extent that such exists, meet
regulatory requirements.</t>
<t>DNS privacy services should not track users except for the particular purpose
of detecting and remedying technically malicious (e.g. DoS) or anomalous use
of the service.</t>
<t>Data access should be minimized to only those personal who require access to
perform operational duties.</t>
</list>
</t>
</section>

<section anchor="data-minimization-of-network-traffic" title="Data minimization of network traffic">
<t>Data minimization refers to collecting, using, disclosing, and storing the
minimal data necessary to perform a task, and this can be achieved by
removing or obfuscating privacy-sensitive information in network traffic logs.
This is typically personal data, or data that can be used to link a record to an
individual, but may also include revealing other confidential information, for
example on the structure of an internal corporate network.
</t>
<t>The problem of effectively ensuring that DNS traffic logs contain no or minimal
privacy-sensitive information is not one that currently has a generally agreed
solution or any Standards to inform this discussion. This section presents and
overview of current techniques to simply provide reference on the current
status of this work.
</t>
<t>Research into data minimization techniques (and particularly IP address
pseudonymization/anonymization) was sparked in the late 1990s/early 2000s,
partly driven by the desire to share significant corpuses of traffic captures
for research purposes. Several techniques reflecting different requirements in
this area and different performance/resource tradeoffs emerged over the course
of the decade. Developments over the last decade have been both a blessing and a
curse; the large increase in size between an IPv4 and an IPv6 address, for
example, renders some techniques impractical, but also makes available a much
larger amount of input entropy, the better to resist brute force
re-identification attacks that have grown in practicality over the period.
</t>
<t>Techniques employed may be broadly categorized as either anonymization or
pseudonymization. The following discussion uses the definitions from <xref target="RFC6973"/>
Section 3, with additional observations from <eref target="https://doi.org/10.1145/3182660">van Dijkhuizen et
al.</eref>
</t>
<t>
<list style="symbols">
<t>Anonymization. To enable anonymity of an individual, there must exist a set of
individuals that appear to have the same attribute(s) as the individual. To
the attacker or the observer, these individuals must appear indistinguishable
from each other.</t>
<t>Pseudonymization. The true identity is deterministically replaced with an
alternate identity (a pseudonym). When the pseudonymization schema is known,
the process can be reversed, so the original identity becomes known again.</t>
</list>
</t>
<t>In practice there is a fine line between the two; for example, how to categorize
a deterministic algorithm for data minimization of IP addresses that produces a
group of pseudonyms for a single given address.
</t>
</section>

<section anchor="ip-address-pseudonymization-and-anonymization-methods" title="IP address pseudonymization and anonymization methods">
<t>As <xref target="I-D.bortzmeyer-dprive-rfc7626-bis"/> makes clear, the big privacy risk in
DNS is connecting DNS queries to an individual and the major vector for this in
DNS traffic is the client IP address.
</t>
<t>There is active discussion in the space of effective pseudonymization of IP
addresses in DNS traffic logs, however there seems to be no single solution that
is widely recognized as suitable for all or most use cases. There are also as
yet no standards for this that are unencumbered by patents. This following table
presents a high level comparison of various techniques employed or under
development today and classifies them according to categorization of technique
and other properties. The list of techniques includes the main techniques in
current use, but does not claim to be comprehensive. <xref target="ip-address-techniques"/>
provides a more detailed survey of these techniques and definitions for the
categories and properties listed below.
</t>
<t><eref target="https://github.com/Sinodun/draft-dprive-bcp-op/blob/master/draft-00/ip_techniques_table.svg">Figure showing comparison of IP address techniques (SVG)</eref>
</t>
<t>The choice of which method to use for a particular application will depend on
the requirements of that application and consideration of the threat analysis of
the particular situation.
</t>
<t>For example, a common goal is that distributed packet captures must be in an
existing data format such as PCAP <xref target="pcap"/> or C-DNS
<xref target="I-D.ietf-dnsop-dns-capture-format"/> that can be used as input to existing
analysis tools. In that case, use of a Format-preserving technique is
essential. This, though, is not cost-free - several authors (e.g. <eref target="https://pdfs.semanticscholar.org/7b34/12c951cebe71cd2cddac5fda164fb2138a44.pdf">Brenker &amp;
Arnes</eref>)
have observed that, as the entropy in a IPv4 address is limited, given
a de-identified log from a target, if an attacker is capable of ensuring
packets are captured by the target and the attacker can send forged traffic
with arbitrary source and destination addresses to that target, any
format-preserving pseudonymization is vulnerable to an attack along the lines
of a cryptographic chosen plaintext attack.
</t>
</section>

<section anchor="pseudonymization-anonymization-or-discarding-of-other-correlation-data" title="Pseudonymization, anonymization or discarding of other correlation data">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>IP TTL/Hoplimit can be used to fingerprint client OS</t>
<t>Tracking of TCP sessions</t>
<t>Tracking of TLS sessions and session resumption mechanisms</t>
<t>Resolvers <spanx style="emph">might</spanx> receive client identifiers e.g. MAC addresses in EDNS(0)
options - some CPE devices are known to add them.</t>
<t>HTTP headers</t>
</list>
</t>
<t>Mitigations:
</t>
<t>
<list style="symbols">
<t>Data minimization or discarding of such correlation data</t>
</list>
</t>
<t>TODO: More analysis here.
</t>
</section>

<section anchor="cache-snooping" title="Cache snooping">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Profiling of client queries by malicious third parties</t>
</list>
</t>
<t>Mitigations:
</t>
<t>TODO: Describe techniques to defend against cache snooping
</t>
</section>
</section>

<section anchor="data-sent-onwards-from-the-server" title="Data sent onwards from the server">
<t>In this section we consider both data sent on the wire in upstream queries and
data shared with third parties.
</t>

<section anchor="protocol-recommendations-1" title="Protocol recommendations">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Transmission of identifying data upstream.</t>
</list>
</t>
<t>Mitigations:
</t>
<t>As specified in <xref target="RFC8310"/> for DNS-over-TLS but applicable to any DNS Privacy
services the server should:
</t>
<t>
<list style="symbols">
<t>Implement QNAME minimization <xref target="RFC7816"/></t>
<t>Honour a SOURCE PREFIX-LENGTH set to 0 in a query containing the EDNS(0)
Client Subnet (ECS) option and not send an ECS option in upstream queries.</t>
</list>
</t>
<t>Optimizations:
</t>
<t>
<list style="symbols">
<t>The server should either
<list style="symbols">
<t>not use the ECS option in upstream queries at all, or</t>
<t>offer alternative services, one that sends ECS and one that does not.</t>
</list></t>
</list>
</t>
<t>If operators do offer a service that sends the ECS options upstream they should
use the shortest prefix that is operationally feasible (NOTE: the authors
believe they will be able to add a reference for advice here soon) and ideally
use a policy of whitelisting upstream servers to send ECS to in order to
minimize data leakage. Operators should make clear in any policy statement what
prefix length they actually send and the specific policy used.
</t>
<t>Additional options:
</t>
<t>
<list style="symbols">
<t>Aggressive Use of DNSSEC-Validated Cache <xref target="RFC8198"/> to reduce the number of
queries to authoritative servers to increase privacy.</t>
<t>Run a copy of the root zone on loopback <xref target="RFC7706"/> to avoid making queries to
the root servers that might leak information.</t>
</list>
</t>
</section>

<section anchor="client-query-obfuscation" title="Client query obfuscation">
<t>Additional options:
</t>
<t>Since queries from recursive resolvers to authoritative servers are performed
using cleartext (at the time of writing), resolver services need to consider the
extent to which they may be directly leaking information about their client
community via these upstream queries and what they can do to mitigate this
further. Note, that even when all the relevant techniques described above are
employed there may still be attacks possible, e.g.
<xref target="Pitfalls-of-DNS-Encryption"/>. For example, a resolver with a very small
community of users risks exposing data in this way and OUGHT obfuscate this
traffic by mixing it with 'generated' traffic to make client characterization
harder. The resolver could also employ aggressive pre-fetch techniques as a
further measure to counter traffic analysis.
</t>
<t>At the time of writing there are no standardized or widely recognized techniques
to preform such obfuscation or bulk pre-fetches.
</t>
<t>Another technique that particularly small operators may consider is forwarding
local traffic to a larger resolver (with a privacy policy that aligns with their
own practices) over an encrypted protocol so that the upstream queries are
obfuscated among those of the large resolver.
</t>
</section>

<section anchor="data-sharing" title="Data sharing">
<t>Threats:
</t>
<t>
<list style="symbols">
<t>Surveillance</t>
<t>Stored data compromise</t>
<t>Correlation</t>
<t>Identification</t>
<t>Secondary use</t>
<t>Disclosure</t>
<t>Contravention of legal requirements not to process user data?</t>
</list>
</t>
<t>Mitigations:
</t>
<t>Operators should not provide identifiable data to third-parties without explicit
consent from clients (we take the stance here that simply using the resolution
service itself does not constitute consent).
</t>
<t>Even when consent is granted operators should employ data minimization
techniques such as those described in <xref target="data-handling"/> if data is shared with
third-parties.
</t>
<t>Operators should consider including specific guidelines for the collection of
aggregated and/or anonymized data for research purposes, within or outside of
their own organization.
</t>
<t>TODO: More on data for research vs operations... how to still motivate operators
to share anonymized data?
</t>
<t>TODO: Guidelines for when consent is granted?
</t>
<t>TODO: Applies to server data handling too.. could operators offer alternatives
services one that implies consent for data processing, one that doesn't?
</t>
</section>
</section>
</section>

<section anchor="dns-privacy-policy-and-practice-statement" title="DNS privacy policy and practice statement">

<section anchor="recommended-contents-of-a-dppps" title="Recommended contents of a DPPPS">
<t>1 Policy
</t>
<t>1.1 Recommendations. This section should explain, with reference to section
      <xref target="recommendations-for-dns-privacy-services"/> of this document which
      recommendations the DNS privacy service employs.
</t>
<t>1.2 Data handling. This section should explain, with reference to section
       <xref target="data-at-rest-on-the-server"/>
       of this document the policy for gathering and disseminating information
       collected by the DNS privacy service.
</t>
<t>1.2.1 Specify clearly what data (including whether it is aggregated,
        pseudonymized or anonymized) is:
</t>
<t>1.2.1.1 Collected and retained by the operator (and for how long)
</t>
<t>1.2.1.2 Shared with partners
</t>
<t>1.2.1.3  Shared, sold or rented to third-parties
</t>
<t>1.2.2  Specify any exceptions to the above, for example technically malicious or
anomalous behaviour
</t>
<t>1.2.3  Declare any partners, third-party affiliations or sources of funding
</t>
<t>1.2.4 Whether user DNS data is correlated or combined with any other personal
      information held by the operator
</t>
<t>2 Practice. This section should explain the current operational practices of the service.
</t>
<t>2.1 Specify any temporary or permanent deviations from the policy for
    operational reasons
</t>
<t>2.2 With reference to section <xref target="on-the-wire-between-client-and-server"/> provide
    specific details of which capabilities are provided on which address and
    ports
</t>
<t>2.3 With reference to section <xref target="data-sent-onwards-from-the-server"/>
    provide specific details of which capabilities are employed for upstream
    traffic from the server
</t>
<t>2.4 Specify the authentication name to be used (if any) and if TLSA records are
    published (including options used in the TLSA records)
</t>
<t>2.5 Specify the SPKI pinsets to be used (if any) and policy for rolling keys
</t>
<t>2.6 Provide a contact email address for the service
</t>
</section>

<section anchor="current-policy-and-privacy-statements" title="Current policy and privacy statements">
<t>NOTE: An analysis of these statements will clearly only provide a snapshot at
the time of writing. It is included in this version of the draft to provide a
basis for the assessment of the contents of the DPPPS and is expected to be
removed or substantially re-worked in a future version.
</t>

<section anchor="quad9" title="Quad9">
<t>UDP/TCP and TLS (port 853) service provided on two addresses:
</t>
<t>
<list style="symbols">
<t>'Secure': 9.9.9.9, 149.112.112.112, 2620:fe::fe, 2620:fe::9</t>
<t>'Unsecured': 9.9.9.10, 149.112.112.10, 2620:fe::10</t>
</list>
</t>
<t>Policy:
</t>
<t>
<list style="symbols">
<t><eref target="https://www.quad9.net/policy/"/></t>
<t><eref target="https://www.quad9.net/privacy/"/></t>
<t><eref target="https://www.quad9.net/faq/"/></t>
</list>
</t>
</section>

<section anchor="cloudflare" title="Cloudflare">
<t>UDP/TCP and TLS (port 853) service provided on 1.1.1.1, 1.0.0.1,
2606:4700:4700::1111 and 2606:4700:4700::1001.
</t>
<t>Policy:
</t>
<t>
<list style="symbols">
<t><eref target="https://developers.cloudflare.com/1.1.1.1/commitment-to-privacy/privacy-policy/privacy-policy/"/></t>
</list>
</t>
<t>DoH provided on: <eref target="https://cloudflare-dns.com/dns-query"/>
</t>
<t>Policy:
</t>
<t>
<list style="symbols">
<t><eref target="https://developers.cloudflare.com/1.1.1.1/commitment-to-privacy/privacy-policy/firefox/"/></t>
</list>
</t>
<t>Tor endpoint: <eref target="https://dns4torpnlfs2ifuz2s2yf3fc7rdmsbhm6rw75euj35pac6ap25zgqad.onion"/>.
</t>
</section>

<section anchor="google" title="Google">
<t>UDP/TCP service provided on 8.8.8.8, 8.8.4.4, 2001:4860:4860::8888 and
2001:4860:4860::8844.
</t>
<t>Policy: <eref target="https://developers.google.com/speed/public-dns/privacy"/>
</t>
</section>

<section anchor="opendns" title="OpenDNS">
<t>UDP/TCP service provided on 208.67.222.222 and 208.67.220.220 (no IPv6).
</t>
<t>We could find no specific privacy policy for the DNS resolution, only a general
one from Cisco that seems focussed on websites.
</t>
<t>Policy: <eref target="https://www.cisco.com/c/en/us/about/legal/privacy-full.html"/>
</t>
</section>

<section anchor="comparison" title="Comparison">
<t>The following tables provides a high-level comparison of the policy and practice
statements above and also some observations of practice measured at
<eref target="https://dnsprivacy.org/jenkins/job/dnsprivacy-monitoring/">dnsprivacy.org</eref>. The
data is not exhaustive and has not been reviewed or confirmed by the operators.
</t>
<t>A question mark indicates no clear statement or data could be located on the
issue. A dash indicates the category is not applicable to the service.
</t>
<t><eref target="https://github.com/Sinodun/draft-dprive-bcp-op/blob/master/draft-00/policy_table.svg">Table showing comparison of operators policies</eref>
</t>
<t><eref target="https://github.com/Sinodun/draft-dprive-bcp-op/blob/master/draft-00/practice_table.svg">Table showing comparison of operators practices</eref>
</t>
<t>NOTE: Review and correction of any inaccuracies in the table would be much
appreciated.
</t>
</section>
</section>

<section anchor="enforcementaccountability" title="Enforcement/accountability">
<t>Transparency reports may help with building user trust that operators adhere to
their policies and practices.
</t>
<t>Independent monitoring should be performed where possible of:
</t>
<t>
<list style="symbols">
<t>ECS, QNAME minimization, EDNS(0) padding, etc.</t>
<t>Filtering</t>
<t>Uptime</t>
</list>
</t>
</section>
</section>

<section anchor="iana-considerations" title="IANA considerations">
<t>None
</t>
</section>

<section anchor="security-considerations" title="Security considerations">
<t>TODO: e.g. New issues for DoS defence, server admin policies
</t>
</section>

<section anchor="acknowledgements" title="Acknowledgements">
<t>Many thanks to Amelia Andersdotter for a very thorough review of the first draft
of this document. Thanks also to John Todd for discussions on this topic, and to
Stephane Bortzmeyer for review.
</t>
<t>Sara Dickinson thanks the Open Technology Fund for a grant to support the work
on this document.
</t>
</section>

<section anchor="contributors" title="Contributors">
<t>The below individuals contributed significantly to the document:
</t>
<t>John Dickinson
<vspace/>
Sinodun Internet Technologies
<vspace/>
Magdalen Centre
<vspace/>
Oxford Science Park
<vspace/>
Oxford  OX4 4GA
<vspace/>
United Kingdom
</t>
<t>Jim Hague
<vspace/>
Sinodun Internet Technologies
<vspace/>
Magdalen Centre
<vspace/>
Oxford Science Park
<vspace/>
Oxford  OX4 4GA
<vspace/>
United Kingdom
</t>
</section>

<section anchor="changelog" title="Changelog">
<t>draft-ietf-dprive-bcp-op-00
</t>
<t>
<list style="symbols">
<t>Initial commit of re-named document after adoption to replace
draft-dickinson-dprive-bcp-op-01</t>
</list>
</t>
<t>



</t>
</section>

</middle>
<back>
<references title="Normative References">
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-terminology-bis.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-doh-dns-over-https.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dprive-padding-policy.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.draft-huitema-quic-dnsoquic-05.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5077.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6265.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6973.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7457.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7525.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7816.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7830.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7858.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7873.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8310.xml"?>
</references>
<references title="Informative References">
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.bortzmeyer-dprive-rfc7626-bis.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-dns-capture-format.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-dns-tcp-requirements.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-session-signal.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-tls-dnssec-chain-extension.xml"?>
<reference anchor='Pitfalls-of-DNS-Encryption'
 target='https://www.ietf.org/mail-archive/web/dns-privacy/current/pdfWqAIUmEl47.pdf'>
    <front>
        <title>Pretty Bad Privacy: Pitfalls of DNS Encryption</title>
        <author initials='H.' surname='Shulman' fullname='Haya Shulman'>
            <organization>Fachbereich Informatik, Technische Universit√§t Darmstadt</organization>
        </author>
        <date year='2014'/>
    </front>
</reference>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6235.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6841.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6873.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7686.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7706.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7766.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7828.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7871.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8094.xml"?>
<?rfc include="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8198.xml"?>
<reference anchor='pcap' target='http://www.tcpdump.org/'>
    <front>
        <title>PCAP</title>
        <author>
            <organization>tcpdump.org</organization>
        </author>
        <date year='2016'/>
    </front>
</reference>
</references>

<section anchor="documents" title="Documents">
<t>This section provides an overview of some DNS privacy related documents,
however, this is neither an exhaustive list nor a definitive statement on the
characteristic of the document.
</t>

<section anchor="potential-increases-in-dns-privacy" title="Potential increases in DNS privacy">
<t>These documents are limited in scope to communications between stub
clients and recursive resolvers:
</t>
<t>
<list style="symbols">
<t>'Specification for DNS over Transport Layer Security (TLS)' <xref target="RFC7858"/>,
referred to here as 'DNS-over-TLS'.</t>
<t>'DNS over Datagram Transport Layer Security (DTLS)' <xref target="RFC8094"/>, referred to
here as 'DNS-over-DTLS'. Note that this document has the Category of
Experimental.</t>
<t>'DNS Queries over HTTPS (DoH)' <xref target="I-D.ietf-doh-dns-over-https"/> referred to
here as DoH.</t>
<t>'Usage Profiles for DNS over TLS and DNS over DTLS' <xref target="RFC8310"/></t>
<t>'The EDNS(0) Padding Option' <xref target="RFC7830"/> and 'Padding Policy for EDNS(0)'
<xref target="I-D.ietf-dprive-padding-policy"/></t>
</list>
</t>
<t>These documents apply to recursive to authoritative DNS but are relevant when
considering the operation of a recursive server:
</t>
<t>
<list style="symbols">
<t>'DNS Query Name minimization to Improve Privacy' <xref target="RFC7816"/> referred to here
as 'QNAME minimization'</t>
</list>
</t>
</section>

<section anchor="potential-decreases-in-dns-privacy" title="Potential decreases in DNS privacy">
<t>These documents relate to functionality that could provide increased tracking of
user activity as a side effect:
</t>
<t>
<list style="symbols">
<t>'Client Subnet in DNS Queries' <xref target="RFC7871"/></t>
<t>'Domain Name System (DNS) Cookies' <xref target="RFC7873"/>)</t>
<t>'Transport Layer Security (TLS) Session Resumption without Server-Side State'
<xref target="RFC5077"/> referred to here as simply TLS session resumption.</t>
<t>'A DNS Packet Capture Format' <xref target="I-D.ietf-dnsop-dns-capture-format"/></t>
<t>Passive DNS <xref target="I-D.ietf-dnsop-terminology-bis"/></t>
</list>
</t>
<t>Note that depending on the specifics of the implementation
<xref target="I-D.ietf-doh-dns-over-https"/> may also provide increased tracking.
</t>
</section>

<section anchor="related-operational-documents" title="Related operational documents">
<t>
<list style="symbols">
<t>'DNS Transport over TCP - Implementation Requirements' <xref target="RFC7766"/></t>
<t>'Operational requirements for DNS-over-TCP'
<xref target="I-D.ietf-dnsop-dns-tcp-requirements"/></t>
<t>'The edns-tcp-keepalive EDNS0 Option' <xref target="RFC7828"/></t>
<t>'DNS Stateful Operations' <xref target="I-D.ietf-dnsop-session-signal"/></t>
</list>
</t>
</section>
</section>

<section anchor="ip-address-techniques" title="IP address techniques">
<t>Data minimization methods may be categorized by the processing used and the
properties of their outputs. The following builds on the categorization
employed in <xref target="RFC6235"/>:
</t>
<t>
<list style="symbols">
<t>Format-preserving. Normally when encrypting, the original data length and
patterns in the data should be hidden from an attacker. Some applications of
de-identification, such as network capture de-identification, require that the
de-identified data is of the same form as the original data, to allow the data
to be parsed in the same way as the original.</t>
<t>Prefix preservation. Values such as IP addresses and MAC addresses contain
prefix information that can be valuable in analysis, e.g. manufacturer ID in
MAC addresses, subnet in IP addresses. Prefix preservation ensures that
prefixes are de-identified consistently; e.g. if two IP addresses are from the
same subnet, a prefix preserving de-identification will ensure that their
de-identified counterparts will also share a subnet. Prefix preservation may
be fixed (i.e. based on a user selected prefix length identified in advance to
be preserved ) or general.</t>
<t>Replacement. A one-to-one replacement of a field to a new value of the same
type, for example using a regular expression.</t>
<t>Filtering. Removing (and thus truncating) or replacing data in a field. Field
data can be overwritten, often with zeros, either partially (grey marking) or
completely (black marking).</t>
<t>Generalization. Data is replaced by more general data with reduced
specificity. One example would be to replace all TCP/UDP port numbers with one
of two fixed values indicating whether the original port was ephemeral
(&gt;=1024) or non-ephemeral (&gt;1024). Another example, precision degradation,
reduces the accuracy of e.g. a numeric value or a timestamp.</t>
<t>Enumeration. With data from a well-ordered set, replace the first data item
data using a random initial value and then allocate ordered values for
subsequent data items. When used with timestamp data, this preserves ordering
but loses precision and distance.</t>
<t>Reordering/shuffling. Preserving the original data, but rearranging its order,
often in a random manner.</t>
<t>Random substitution. As replacement, but using randomly generated replacement
values.</t>
<t>Cryptographic permutation. Using a permutation function, such as a hash
function or cryptographic block cipher, to generate a replacement
de-identified value.

<vspace/></t>
</list>
</t>

<section anchor="google-analytics-nonprefix-filtering" title="Google Analytics non-prefix filtering">
<t>Since May 2010, <eref target="https://support.google.com/analytics/answer/2763052?hl=en">Google Analytics has provided a facility</eref> that allows website
owners to request that all their users IP addresses are anonymized within
Google Analytics processing. This very basic anonymization simply sets to zero
the least significant 8 bits of IPv4 addresses, and the least significant 80
bits of IPv6 addresses. The level of anonymization this produces is perhaps
questionable. There are <eref target="https://www.conversionworks.co.uk/blog/2017/05/19/anonymize-ip-geo-impact-test/">some analysis results</eref>
which suggest that the impact of
this on reducing the accuracy of determining the user's location from their IP
address is less than might be hoped; the average discrepancy in identification
of the user city for UK users is no more than 17%.
</t>
<t>Anonymization: Format-preserving, Filtering (grey marking).
</t>
</section>

<section anchor="dnswasher" title="dnswasher">
<t>Since 2006, PowerDNS have included a de-identification tool <eref target="https://github.com/edmonds/pdns/blob/master/pdns/dnswasher.cc">dnswasher</eref> with
their PowerDNS product. This is a PCAP filter that performs a one-to-one mapping
of end user IP addresses with an anonymized address. A table of user IP
addresses and their de-identified counterparts is kept; the first IPv4 user
addresses is translated to 0.0.0.1, the second to 0.0.0.2 and so on. The
de-identified address therefore depends on the order that addresses arrive in
the input, and running over a large amount of data the address translation
tables can grow to a significant size.
</t>
<t>Anonymization: Format-preserving, Enumeration.
</t>
</section>

<section anchor="prefixpreserving-map" title="Prefix-preserving map">
<t>Used in <eref target="http://ita.ee.lbl.gov/html/contrib/tcpdpriv.html">TCPdpriv</eref>,
this algorithm stores a set of original and anonymised IP
address pairs. When a new IP address arrives, it is compared with previous
addresses to determine the longest prefix match. The new address is anonymized
by using the same prefix, with the remainder of the address anonymized with a
random value. The use of a random value means that TCPdrpiv is not
deterministic; different anonymized values will be generated on each run. The
need to store previous addresses means that TCPdpriv has significant and
unbounded memory requirements, and because of the need to allocated anonymized
addresses sequentially cannot be used in parallel processing.
</t>
<t>Anonymization: Format-preserving, prefix preservation (general).
</t>
</section>

<section anchor="cryptographic-prefixpreserving-pseudonymisation" title="Cryptographic Prefix-Preserving Pseudonymisation">
<t>Cryptographic prefix-preserving pseudonymisation was originally proposed as an
improvement to the prefix-preserving map implemented in TCPdpriv, described in
<eref target="http://an.kaist.ac.kr/~sbmoon/paper/intl-journal/2004-cn-anon.pdf">Xu et al.</eref>
and implemented in the <eref target="https://www.cc.gatech.edu/computing/Telecomm/projects/cryptopan/">Crypto-PAn tool</eref>.
Crypto-PAn is now frequently
used as an acronym for the algorithm. Initially it was described for IPv4
addresses only; extension for IPv6 addresses was proposed in <eref target="http://mharvan.net/talks/noms-ip_anon.pdf">Harvan &amp;
Sch√∂nw√§lder</eref> and implemented in
snmpdump. This uses a cryptographic algorithm
rather than a random value, and thus pseudonymity is determined uniquely by the
encryption key, and is deterministic. It requires a separate AES encryption for
each output bit, so has a non-trivial calculation overhead. This can be
mitigated to some extent (for IPv4, at least) by pre-calculating results for
some number of prefix bits.
</t>
<t>Pseudonymization: Format-preserving, prefix preservation (general).
</t>
</section>

<section anchor="tophash-subtreereplicated-anonymisation" title="Top-hash Subtree-replicated Anonymisation">
<t>Proposed in Ramaswamy &amp; Wolf, Top-hash Subtree-replicated Anonymisation (TSA)
originated in response to the requirement for faster processing than Crypto-PAn.
It used hashing for the most significant byte of an IPv4 address, and a
pre-calculated binary tree structure for the remainder of the address. To save
memory space, replication is used within the tree structure, reducing the size
of the pre-calculated structures to a few Mb for IPv4 addresses. Address
pseudonymization is done via hash and table lookup, and so requires minimal
computation. However, due to the much increased address space for IPv6, TSA is
not memory efficient for IPv6.
</t>
<t>Pseudonymization: Format-preserving, prefix preservation (general).
</t>
</section>

<section anchor="ipcipher" title="ipcipher">
<t>A <eref target="https://medium.com/@bert.hubert/on-ip-address-encryption-security-analysis-with-respect-for-privacy-dabe1201b476">recently-released proposal from PowerDNS</eref>,
<eref target="https://github.com/PowerDNS/ipcipher">ipcipher</eref> is a simple
pseudonymization technique for IPv4 and IPv6 addresses. IPv6 addresses are
encrypted directly with AES-128 using a key (which may be derived from a
passphrase). IPv4 addresses are similarly encrypted, but using a recently
proposed encryption <eref target="https://github.com/veorq/ipcrypt">ipcrypt</eref> suitable for 32bit
block lengths. However, the author of ipcrypt has <eref target="https://www.ietf.org/mail-archive/web/cfrg/current/msg09494.html">since indicated</eref> that it has
low security, and further analysis has revealed it is vulnerable to attack.
</t>
<t>Pseudonymization: Format-preserving, cryptographic permutation.
</t>
</section>

<section anchor="bloom-filters" title="Bloom filters">
<t><eref target="https://tnc18.geant.org/core/presentation/127">van Rijswijk-Deij et al.</eref>
have recently described work using Bloom filters to
categorize query traffic and record the traffic as the state of multiple
filters. The goal of this work is to allow operators to identify so-called
Indicators of Compromise (IOCs) originating from specific subnets without
storing information about, or be able to monitor the DNS queries of an
individual user. By using a Bloom filter, it is possible to determine with a
high probability if, for example, a particular query was made, but the set of
queries made cannot be recovered from the filter. Similarly, by mixing queries
from a sufficient number of users in a single filter, it becomes practically
impossible to determine if a particular user performed a particular query. Large
numbers of queries can be tracked in a memory-efficient way. As filter status is
stored, this approach cannot be used to regenerate traffic, and so cannot be
used with tools used to process live traffic.
</t>
<t>Anonymized: Generalization.
</t>
</section>
</section>

</back>
</rfc>
